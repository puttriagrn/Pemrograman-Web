<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add Product</title>
    <link rel="stylesheet" href="assets/style.css">
    <script>
        // Fungsi untuk mengonversi gambar ke Base64
        function toBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => resolve(reader.result.split(',')[1]); // Hapus prefix "data:image/jpeg;base64,"
                reader.onerror = error => reject(error);
            });
        }

        // Fungsi untuk menangani pengiriman formulir
        async function handleFormSubmit(event) {
            event.preventDefault(); // Cegah reload halaman

            const name = document.getElementById('productName').value.trim();
            const price = document.getElementById('productPrice').value.trim();
            const imageFile = document.getElementById('productImage').files[0];

            if (!name || !price || !imageFile) {
                alert('All fields are required!');
                return;
            }

            try {
                const base64Image = await toBase64(imageFile); // Konversi gambar ke Base64
                const data = {
                    name,
                    price: parseFloat(price),
                    image: base64Image,
                };

                const response = await fetch('http://localhost/modul4/api.php', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data),
                });

                const result = await response.json();
                if (response.ok) {
                    alert('Product added successfully!');
                    // Redirect ke halaman utama
                    window.location.href = 'index.html';
                } else {
                    alert(result.error || 'Failed to add product');
                }
            } catch (error) {
                console.error(error);
                alert('Something went wrong. Please try again.');
            }
        }

        // Tambahkan event listener ke formulir
        window.addEventListener('DOMContentLoaded', () => {
            const form = document.querySelector('form');
            form.addEventListener('submit', handleFormSubmit);
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="container">
            <div class="nav-center">
                <a href="index.html">Home</a>
                <a href="addProduct.html">Add Product</a>
                <a href="#">Delete Product</a>
            </div>
        </div>
    </nav>

    <div class="form-container">
        <h2>Add New Product</h2>
        <form>
            <div class="form-group">
                <label for="productName">Product Name</label>
                <input type="text" id="productName" placeholder="Enter product name" required>
            </div>
            <div class="form-group">
                <label for="productPrice">Product Price</label>
                <input type="number" id="productPrice" placeholder="Enter product price" required>
            </div>
            <div class="form-group">
                <label for="productImage">Select Product Image</label>
                <input type="file" id="productImage" accept="image/*" required>
            </div>
            <div class="form-group">
                <button type="submit">Add Product</button>
            </div>
        </form>
    </div>

</body>
</html>
